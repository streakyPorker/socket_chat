# 多人聊天室实验报告

> 学号：3180102908
>
> 姓名：柳湛宇
>
> 专业：软件工程

## 文件结构

`ChatClient.java`和``ChatServer.java`是客户端与服务端的源文件，对应了2个jar包，`backup.txt`存储了一次server运行时所有用户的发言

## 代码实现原理

#### 1. server端

使用`ConcurrentHashMap`存储用户集合和他们对应的输出流，使用`LinkedBlockingQueue`存储用户信息队列。首先将一个写入信息到后背文件的输出流加入到Map中，从而能够备份文件。



之后创建信息分派进程，用于将用户发送的信息分派到所有用户，不断扫描。完成后开始监听用户连接，每成功连接产生一个socket，创建一个线程来处理这个socket对应用户的输入，处理方法其实就是将信息写入信息队列中。在客户端退出时，对应的线程也退出，输入、输出流也被回收。



分派进程就是获取信息队列的头部，当结果非空时，将所有信息写出对应的输出流。

#### 2. Client端

服务端通过请求获得socket，并通过这个socket建立输入和输出两个进程。



输入进程读取服务端的输入，简单地处理初试信息进而获得其当前的id。之后可以直接输出获得的文本。同时在服务端结束进城后能够感知并作反应。



输出进程获取标准输出，链接自己的信息后输出到server端。

## 心得

这次的socket编程实验让我简单了解了Java语言中的网络编程和多线程编程的一些基础，和计算机网络的socket c库相比，可以看到Java语言进行了比较好的封装。本次实验比较多地试用了JUC中的并发数据结构，可以使得程序运行的效率和正确率较之自己写同步代码高一些。但是本次实验仍然有一些设计上的不足，后序可以持续改进。